# Final LAB Trainning


## Introduction:


There are trhee enviroments, tow of them mus be generates by the RedHat lab web https://labs.opentlc.com/

    -- Ansible Advanced - Homework (Tower)
	   -- Ansible Advanced NG - OpenStack (QA: Openstack)

The third enviroment is generated by a playbook in the workfow :

     -- Ansible Advanced - Three Tier App (PRO: AWS)

## Pre requirements:

Be sure that you have been configures your SSH key on https://labs.opentlc.com/

Copy your OPENTLC private key to the Ansible Advanced - Homework control host under the root user’s home directory.

The path to your OPENTLC key is /root/.ssh/mykey.pem.

Set the permissions of the /root/.ssh/mykey.pem file to 0400 and set the owner as root:root.

You need toSet Up Control host 

      export TOWER_GUID=<Tower env GUID>
      export OSP_GUID=<OSP Env GUID>
      export OSP_DOMAIN=<OSP Env domain name>
      export OPENTLC_ID=<username-example.com>
      export MAIL_ID=<username@example.com>
      export OPENTLC_PASSWORD=<Your OPENTLC Password>
      export GITHUB_REPO=https://github.com/<github username>/nextgen_ansible_advanced_homework.git
      export JQ_REPO_BASE=http://www.opentlc.com/download/ansible_bootcamp
      export REGION=us-east-1

Run the site-setup-prereqs.yaml playbook to provision the network, flavor, security groups, and SSH keys:

        [root@control ~/nextgen_ansible_advanced_homework]# mv ~/ansible-tower-setup-*/ ~/ansible-tower-setup-latest
        [root@control ~/nextgen_ansible_advanced_homework]# cp /etc/ansible/hosts ~/ansible-tower-setup-latest/inventory
        [root@control ~/nextgen_ansible_advanced_homework]# chmod 0400 /root/.ssh/openstack.pem
        [root@control ~/nextgen_ansible_advanced_homework]# ansible-playbook site-setup-prereqs.yaml -k
        Password:<copy your OSP workstation password from email>

The playbook sets up openstack.pem as a private key and openstack.pub as a public key for connecting to the workstation host from the control host.

The playbook also sets up workstation-${OSP_GUID}.${OSP_DOMAIN} as an isolated node.

Verify a successful connection between the control and workstation hosts using the openstack.pem key:

      [root@control ~/nextgen_ansible_advanced_homework]# ssh -i /root/.ssh/openstack.pem cloud-user@workstation-${OSP_GUID}.${OSP_DOMAIN}
      [cloud-user@workstation ~]$ exit
      
From your web browser, connect to tower1.${TOWER_GUID}.example.opentlc.com to verify that the isolated node is operational, using admin for the username and password As provided in email.


## Review Tower configuration:

### Templates :

         -- 01_Provision Prod Env 
         -- 02_Provision QA Env
         -- 04_3tier app deployment on QA Env 
         -- 05_Smoke test QA Env 
         -- 07_Prod Check the status of AWS instances
         -- 08_Prod SSH keys 
         -- 09_3 tier app on Prod 
         -- 10_Smoke test Prod env
         -- cicd_workflow
         -- Demo Job Template
         -- Plantilla de trabajo
         -- Nuke QA Env
         
### Credencials

.List of Credencials
[%header,cols=2*]
|===
| Credential name           | Type                        
| AWS Access                | Key Amazon Web Services    
| Connect_to_workstation    | Machine                     
| Creds for AWS instances   | Machine                    
| Demo Credential           | Machine                    
| Opentlc key               | Machinee                   
| Opentlc key test *        | Machine                     
| yum-repo-cred             | Vault
|===


## Inventories

		  -- Demo Inventory
		  -- Prod Three tier inventory
		  -- scm_inventory

# Run the workfow

Run the workflow template from the Ansible Tower UI, which must be able to run successfully according to these requirements:

		-- Provision instances in the OpenStack QA environment
		-- Deploy the application in the QA environment
		-- Run the smoke test to verify the application

Like there is an error with the SSH key , please revie Notes* you need to run the next templates direcly from Tower

		-- Provision instances on AWS using order_svc.sh script for the production environment
		-- Deploy the application in the production environment
		-- Run the smoke test to verify the application


### Notes 1

Connection to prod bastion instance didn't work for my user, therefore step **08_Prod SSH keys three tier app** failed.
To overcome this, create a new credencial called Opentlc key test * and insert your bastion´s access password and re-run the workflow from failed step or from start.

### Notes  2

On the last one thre is a mistake because the playbook use the public IP to check the status that is frobidden, a workaround could be use the internal IP to test.

## Note 3

On the site-smoke-test-aws.ym ans in the grading-script.yml have the same error on the lb configuration for the QA run well the template

		-- server app{{loop.index}} {{hostvars[host]['inventory_hostname']}}:8080 cookie app{{loop.index}} check

But for de AWX environmet must be changes for 

		-- erver app{{loop.index}} {{hostvars[host]['private_ip_address']}}:8080 cookie app{{loop.index}} check
		
This is the reason why it do not runs well ans answer Service is unavailable.




